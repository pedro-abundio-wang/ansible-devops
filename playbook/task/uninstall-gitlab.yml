# https://forum.gitlab.com/t/complete-uninstall-gitlab-ce-from-ubuntu-14/6232/2

# Uninstall Gitlab
- name: Remove gitlab services, data and account
  shell: |
    gitlab-ctl uninstall
    gitlab-ctl cleanse
    gitlab-ctl remove-accounts
  register: uninstall_ret
  failed_when:
    - uninstall_ret.rc != 0
    - "'gitlab-ctl: not found' not in uninstall_ret.stderr"

- name: Uninstall gitlab package
  shell: dpkg -P gitlab-ce

# /opt/gitlab holds application code for GitLab and its dependencies.
# /var/opt/gitlab holds application data and configuration files that gitlab-ctl reconfigure writes to.
# /etc/gitlab holds configuration files for omnibus-gitlab. These are the only files that you should ever have to edit manually.
# /var/log/gitlab contains all log data generated by components of omnibus-gitlab.
- name: Clean gitlab data
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /opt/gitlab
    - /etc/gitlab
    - /var/opt/gitlab
    - /var/log/gitlab
